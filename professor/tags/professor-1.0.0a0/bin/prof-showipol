#! /usr/bin/env python
"""%prog [SWITCHES] IPOL.pkl [IPOL2.pkl ...]

Show information about the interpolations in the given pickle files.
Use --help to get the availabe switches that select what is shown.
"""

import sys
import os
import optparse

import professor.user as prof

parser = optparse.OptionParser(usage=__doc__)

parser.add_option("-r", "--runs",
        dest = "runs",
        action = "store_true",
        help = "show the MC-runs (default)")
parser.add_option("-R", "--no-runs",
        dest = "runs",
        action = "store_false",
        help = "do not show the MC-runs")

parser.add_option("-n", "--numruns",
        dest = "numruns",
        action = "store_true",
        help = "show the number of MC-runs (default)")
parser.add_option("-N", "--no-numruns",
        dest = "numruns",
        action = "store_false",
        help = "do not show the number of MC-runs")

parser.add_option("-m", "--method",
        dest = "method",
        action = "store_true",
        help = "show the used interpolation method")
parser.add_option("-M", "--no-method",
        dest = "method",
        action = "store_false",
        help = "do not show the used interpolation method (default)")

parser.add_option("-o", "--observables",
        dest = "observables",
        action = "store_true",
        help = "show the interpolated observables")
parser.add_option("-O", "--no-observables",
        dest = "observables",
        action = "store_false",
        help = "do not show the interpolated observables (default)")

parser.add_option("-c", "--center",
        dest = "center",
        action = "store_true",
        help = "show the center used for interpolating")
parser.add_option("-C", "--no-center",
        dest = "center",
        action = "store_false",
        help = "do not show the center used for interpolating (default)")

parser.set_defaults(
        runs=True,
        numruns=True,
        method=False,
        observables=False,
        center=False
        )

opts, args = parser.parse_args()

if len(args) == 0:
    sys.stderr.write(parser.format_help())
    sys.stderr.write("\n\nNo files given!\n")
    sys.exit(1)

prof.writeGuideLine()

for f in args:
    print os.path.basename(f)
    ipolset = prof.InterpolationSet.fromPickle(f)
    if opts.numruns:
        print ">> #runs: %i" % (len(ipolset.runskey.split(":")))
    if opts.runs:
        print ">> runs:"
        print ipolset.runskey.replace(":", " ")
    if opts.method:
        print ">> method: %s" % (ipolset.ipolmethod.method)
    if opts.observables:
        obslist = set()
        for key in ipolset.iterkeys():
            obsname = key.split(":")[0]
            obslist.add(obsname)

        print ">> observables:"
        print " ".join(sorted(obslist))
    if opts.center:
        print ">> center: %s" % (ipolset.center)
